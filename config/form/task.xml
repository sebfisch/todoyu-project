<?xml version="1.0" encoding="UTF-8"?>
<form>
	<attributes>
		<attribute name="action">?ext=project&amp;controller=task</attribute>
		<attribute name="name">task</attribute>
		<attribute name="onsubmit">return false</attribute>
		<attribute name="class">formTask</attribute>
	</attributes>
	<hiddenFields>
		<field name="id" />
		<field name="id_project" />
		<field name="type" />
	</hiddenFields>
	<fieldsets>

		<fieldset name="left">
			<legend>Left form column</legend>
			<class>left noneFloatingInput</class>
			<elements>

				<field type="textinput" name="title">
					<label>core.title</label>
					<validate>
						<isNotEmpty msg="task.error.title" />
					</validate>
					<required />
				</field>

				<field type="RTE" name="description">
					<label>core.description</label>
					<tinymce>
						<theme>simple</theme>
						<width>350px</width>
						<height>200px</height>
					</tinymce>
					<required />
				</field>

			</elements>
		</fieldset>

		<fieldset name="right">
			<legend>Riht form column</legend>
			<class>right</class>
			<elements>

				<field type="datetimeinput" name="date_start">
					<label>task.date_start</label>
					<required/>
				</field>

				<field type="datetimeinput" name="date_end">
					<label>task.date_end</label>
					<validate>
						<dateNotBefore>
							<field>date_start</field>
							<allowEmpty />
						</dateNotBefore>
					</validate>
				</field>

				<field type="datetimeinput" name="date_deadline">
					<label>task.date_deadline</label>
					<validate>
						<dateNotBefore msg="Deadline date has to be after startdate">
							<field>date_start</field>
							<allowEmpty />
						</dateNotBefore>
					</validate>
					<required/>
				</field>

				<field type="select" name="status">
					<label>task.attr.status</label>
					<source type="function">
						<function>TodoyuProjectViewHelper::getProjectStatusOptions</function>
						<lazyInit />
					</source>
				</field>

				<field type="select" name="id_user_assigned">
					<label>task.user_assigned</label>
					<source type="function">
						<function>TodoyuTaskViewHelper::getTaskAssignUserOptions</function>
						<lazyInit />
					</source>
					<validate>
						<isNotZero msg="LLL:task.attr.user_assigned.error"/>
					</validate>
				</field>

				<field type="select" name="id_user_owner">
					<label>task.user_owner</label>
					<source type="sql">
						<fields>id,lastname,firstname</fields>
						<tables>ext_user_user</tables>
						<where>type = 1 AND active = 1 AND deleted = 0</where>
						<order>lastname,firstname</order>
						<label>TodoyuProjectViewHelper::concatName</label>
						<value>id</value>
					</source>
				</field>

				<field type="textinputAC" name="id_parenttask">
					<label>Taskparent</label>
					<config>
						<acListener>
							<ext>project</ext>
							<controller>task</controller>
							<action>autocompleteprojecttask</action>
							<minChars>1</minChars>
						</acListener>
						<acLabelFunc>TodoyuTaskManager::getAutocompleteLabel</acLabelFunc>
					</config>
				</field>

				<field type="select" name="id_worktype">
					<label>task.worktype</label>
					<source type="function">
						<function>TodoyuTaskViewHelper::getTaskWorktypeOptions</function>
						<lazyInit />
					</source>
					<validate>
						<isNotZero msg="LLL:task.attr.id_worktype.error"/>
					</validate>
				</field>

				<field type="duration" name="estimated_workload">
					<label>task.esitmated_workload</label>
					<validate>
						<isNotZerotime msg="LLL:task.attr.estimated_workload.error"/>
					</validate>
					<required/>
				</field>

				<field type="checkbox" name="is_estimatedworkload_public">
					<label>task.attr.is_estimatedworkload_public</label>
				</field>

				<field type="checkbox" name="is_public">
					<label>task.attr.is_public</label>
				</field>

			</elements>
		</fieldset>

		<fieldset name="buttons">
			<legend>Actions</legend>
			<class>buttons</class>
			<elements>
				<field type="saveButton" name="save">
					<onclick>Todoyu.Ext.project.Task.Edit.save(this.form)</onclick>
				</field>				
				<field type="cancelButton" name="cancel">
					<onclick>Todoyu.Ext.project.Task.Edit.cancel(#id#)</onclick>
				</field>
			</elements>
		</fieldset>
	</fieldsets>
</form>