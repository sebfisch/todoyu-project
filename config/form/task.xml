<?xml version="1.0" encoding="UTF-8"?>
<form>
	<attributes>
		<attribute name="action">?ext=project&amp;controller=task</attribute>
		<attribute name="name">task</attribute>
	</attributes>
	<hiddenFields>
		<field name="id" />
		<field name="id_project" />
		<field name="type" />
	</hiddenFields>
	<fieldsets>

		<fieldset name="left">
			<legend>Left form column</legend>
			<class>left noneFloatingInput</class>
			<elements>

				<field type="text" name="title">
					<label>core.title</label>
					<validate>
						<isNotEmpty msg="task.error.title" />
					</validate>
					<required />
				</field>

				<field type="RTE" name="description">
					<label>core.description</label>
					<tinymce>
						<theme>simple</theme>
						<width>100%</width>
						<height>200px</height>
					</tinymce>
				</field>

			</elements>
		</fieldset>

		<fieldset name="right">
			<legend>Right form column</legend>
			<class>right</class>
			<elements>

				<field type="datetime" name="date_start">
					<label>task.date_start</label>
					<restrict>
						<allow ext="project" right="task:editDateStart" />
					</restrict>
					<required/>
				</field>

				<field type="datetime" name="date_end">
					<label>task.date_end</label>
					<validate>
						<dateNotBefore>
							<field>date_start</field>
							<allowEmpty />
						</dateNotBefore>
					</validate>
					<restrict>
						<allow ext="project" right="task:editDateEnd" />
					</restrict>
				</field>

				<field type="datetime" name="date_deadline">
					<label>task.date_deadline</label>
					<validate>
						<dateNotBefore msg="Deadline date has to be after startdate">
							<field>date_start</field>
							<allowEmpty />
						</dateNotBefore>
					</validate>
					<restrict>
						<allow ext="project" right="task:editDeadline" />
					</restrict>
					<required/>
				</field>

				<field type="select" name="status">
					<label>task.attr.status</label>
					<source type="function">
						<function>TodoyuProjectTaskViewHelper::getTaskStatusOptions</function>
						<lazyInit />
					</source>
					<noPleaseSelect />
					<restrict>
						<allow ext="project" right="task:editStatus" />
					</restrict>
				</field>

 				<field type="selectgrouped" name="id_person_assigned">
					<label>task.attr.person_assigned</label>
					<source type="function">
						<function>TodoyuProjectTaskViewHelper::getPersonAssignedGroupedOptions</function>
						<lazyInit/>
					</source>
					<restrict>
						<allow ext="project" right="task:editPersonAssigned" />
					</restrict>
					 <required />
				</field>

				<field type="selectgrouped" name="id_person_owner">
					<label>task.attr.person_owner</label>
					<source type="function">
						<function>TodoyuProjectTaskViewHelper::getTaskOwnerOptions</function>
						<lazyInit />
					</source>
					<restrict>
						<allow ext="project" right="task:editPersonOwner" />
					</restrict>
				</field>

				<field type="textAC" name="id_parenttask">
					<label>task.attr.id_parenttask</label>
					<config>
						<acName>projecttask</acName>
						<acLabel>TodoyuProjectTaskManager::getAutocompleteLabel</acLabel>
						<options>
							<onComplete>Todoyu.Ext.project.Task.Edit.onParenttaskAutocomplete</onComplete>
						</options>
					</config>
				</field>

				<field type="select" name="id_activity">
					<label>task.attr.activity</label>
					<source type="function">
						<function>TodoyuProjectTaskViewHelper::getTaskActivityOptions</function>
						<lazyInit />
					</source>
					<validate>
						<isNotZero msg="LLL:task.attr.id_activity.error"/>
					</validate>
					<restrict>
						<allow ext="project" right="task:editActivity" />
					</restrict>
					<required/>
				</field>

				<field type="duration" name="estimated_workload">
					<label>task.attr.estimated_workload</label>
					<validate>
						<isNotZerotime msg="LLL:task.attr.estimated_workload.error"/>
					</validate>
					<restrict>
						<allow ext="project" right="task:editEstimatedWorkload" />
					</restrict>
					<required/>
				</field>

				<field type="checkbox" name="is_public">
					<label>task.attr.is_public.public</label>
					<restrict>
						<allow ext="project" right="task:editIsPublic" />
					</restrict>
				</field>

			</elements>
		</fieldset>

		<fieldset name="buttons">
			<legend>Actions</legend>
			<class>buttons</class>
			<elements>

				<field type="cancelButton" name="cancel">
					<onclick>Todoyu.Ext.project.Task.Edit.cancel(#id#)</onclick>
				</field>

				<field type="saveButton" name="save">
					<onclick>Todoyu.Ext.project.Task.Edit.save(this.form)</onclick>
				</field>

			</elements>
		</fieldset>
	</fieldsets>
</form>